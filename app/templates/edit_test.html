{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Edit Test</h1>
    <form action="{{ url_for('edit_test', test_id=test.id) }}" method="post" enctype="multipart/form-data">
        {% for group in test_structure['formGroups'] %}
            {% for field in group['fields'] %}
                <div class="form-group">
                    <label for="{{ field.name }}">{{ field.label }}</label>
                    {% if field.type == 'textarea' %}
                        <textarea class="form-control" id="{{ field.name }}" name="{{ field.name }}">{{ test_data.get(field.name, '') or '' }}</textarea>
                    {% elif field.type == "file" %}
                        <!-- Display current files with option to remove -->
                        {% for file in test_data.get('files', []) %}
                        <div class="file-display">
                            <a href="{{ url_for('download_file', test_id=test.id, filename=file) }}" download>{{ file }}</a>
                            <input type="checkbox" name="files_to_remove[]" value="{{ file }}"> Remove
                        </div>
                        {% endfor %}
                        <!-- Input for adding new files -->
                        <div class="form-group">
                            <label for="new_files">Add More Files:</label>
                            <input type="file" name="new_files" id="new_files" class="form-control" multiple>
                            <small>Add more files if needed.</small>
                        </div>
                    {% else %}
                        <input type="{{ field.type }}" class="form-control" id="{{ field.name }}" name="{{ field.name }}" value="{{ test_data.get(field.name, '') or '' }}" {% if field.readonly %}readonly{% endif %}>
                    {% endif %}
                </div>
            {% endfor %}
        {% endfor %}
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
</div>
{% endblock %}
